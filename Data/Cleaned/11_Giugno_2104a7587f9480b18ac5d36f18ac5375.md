# 11 Giugno

Tags: codice
.: No

## Redis

```bash
# creazione di una coppia chiave valore
SET big_data.name "pippo"

# ottenere il valore di "big_data.name"
GET big_data.name

# controllo dell'esistenza della chiave
EXISTS big_data.name

# eliminazione della chiave
DEL big_data.name
```

```bash
# aggiornamenti del valore associato alla chiave
INCR big_data.name
INCRBY big_data.name 100

# è possibile mettere una specie di ttl per una coppia key-value
EXPIRE big_data:num 120
# rimozione del expiration-time
PERSIST big_data:num
# controllo del time-to-live
TTL big_data:num
```

```bash
# operazioni con le liste
RPUSH friends "Alice" > aggiunta in coda
RPOP friends          > rimozione in coda

LPUSH friends "Bob"   > aggiunta in testa
LPOP friends          > rimozione in testa

# lunghezza della lista
LLEN friends

> per creare una lista basta utilizzare RPUSH
```

```python
import redis

client=redis.StrictRedis(
		host="localhost",
		port=6379
)
client.set(name="big_data:name", value="pippo")
print(client.get(name="big_data:name")).decode("utf-8")
```

## Cassandra

```bash
# creazione di un keyspace
CREATE KEYSPACE IF NOT EXISTS store
WITH REPLICATION = { 'class' : 'SimpleStrategy', 'replication_factor' : 1 };

# creazione di una famiglia di colonne nel keyspace
CREATE TABLE IF NOT EXISTS store.shopping_cart (
		prod_id text PRIMARY KEY,
		item_count int,
		last_update_timestamp timestamp
);

# inserimenti
INSERT INTO store.shopping_cart (prod_id, item_count, last_update_timestamp)
VALUES ('9876', 2, toTimeStamp(toDate(now())));
USING TTL 20; > se si volesse avere un tempo di expiration

# operazioni di retrieve
SELECT * FROM store.shopping_cart

# operazioni di update
UPDATE store.shopping_cart
SET item_count=6,
	 last_update_timestamp=toTimeStamp(toDate(now()))
WHERE prod_id='9876';
```

```python
from cassandra.cluster import Cluster

hosts = ['localhost']
port = 9042

cluster = Cluster(contact_points=hosts, port=port)
session = cluster.connect(
		keyspace="store",
		wait_for_all_pools=True
)

rows = session.execute('SELECT * FROM store.shopping_cart')

for row in rows:
		print(row)
```

## MongoDB

```bash
# creazione o switch del database corrente
use store
```

```jsx
// inserimento di un elemento all'interno della tabella products
db.products.insertOne({name:"x"})
db.getCollection("products").insertOne({name:"x"})

// inserimento con custom id
db.products.insertOne({
		_id:"my_id",
		name:"z"
})

// inserimento di più elementi
db.products.insertMany([
		{name:"a"},
		{name:"b"},
		{name:"c"}
])
```

```jsx
// equivalente di SELECT *
db.products.find()

// si prendono tutti gli elementi che hanno:
//     - l'attributo "status" equivalente ad "A"
//     - o che "qty" sia minore di 30 o "item" che inizia con "p"
db.products.find({
		status:"A",
		$or: [{qty: {$lt:30}}, item: /^p/]
})
```

```jsx
// operazioni di aggiornamento
db.products.updateOne(
		{name:"a"},
		{
				$set: {
						name:"aaa", status:"updated"
				},
				$currentDate: {
						lastModified: true
				}
		}
)

db.products.updateMany(
		{},  // vuoto per aggiornarli tutti
		{
				$set: {
						status:"OK"
				},
				$currentDate: {
						lastModified: true
				}
		}
)
```

```jsx
// operazioni di eliminazione
db.products.deleteOne({
		name:"aaa"
})

// eliminazione che ha un certo pattern
// se il pattern non c'è allora si elimina tutto
db.products.deleteMany({})
```

```python
from pymongo import MongoClient

host="localhost"
port=27017
client=MongoClient(host=host, port=port)

store_db = client["store"]
products_coll = store_db.products

product_1 = {
		"name": "a",
		"status": "OK"
}
products_coll.insert_one(product_1)

#oppure
products = [{...}, {...}]
products_coll.insert_many(products)
```

```python
# operazioni di lettura
cursor_all = products_coll.find()
for document in cursor_all:
		print(document)
print()

# esempio 1
cursor_all = products_coll.find({
		"status": "NOT OK"
})
for document in cursor_all:
		print(document)
print()

# esempio 2
cursor_all = products_coll.find(
		{
				"$or": [
						{"status": "NOT OK"},
						{"name": "n"}
				]
		}
)
for document in cursor_all:
		print(document)
print()

# operazione di eliminazione
products_coll.delete_many({})
```