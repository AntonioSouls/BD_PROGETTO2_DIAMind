# 5 Aprile

Argomenti: Algoritmo k-NN, KD-trees
.: No

## Document Retrieval

Nel document retrieval è necessario trovare un modo per misurare la similarità tra un corpus di documenti, per effettuare le ricerche si utilizza l’approccio del nearest neighbor. Di seguito sono mostrati 2 algoritmi che utilizzano l’approccio nearest neighbor.

## Algoritmo 1-NN

Si da in input un documento $\bold x_q$ per la query e documenti $\bold x_i$ con $i\in[1,n]$, in output viene dato il documento $\bold x_i$ più vicino a $\bold x_q$

![Screenshot from 2024-04-06 15-54-36.png](Screenshot_from_2024-04-06_15-54-36.png)

## Algoritmo k-NN

Si da in input un documento $\bold x_q$ per la query e documenti $\bold x_i$ con $i\in[1,n]$, in output viene dato una lista dei $k$ documenti più vicini a $\bold x_q$

![Screenshot from 2024-04-06 15-56-00.png](Screenshot_from_2024-04-06_15-56-00.png)

## Criticità della NN search

Per effettuare una ricerca dei nearest neighbors occorre risolvere i seguenti problemi:

- rappresentazione degli item coinvolti
- valutazione della distanza tra gli item, quindi definire una metrica che consenta di calcolare la similarità tra i vari item

## Rappresentazione dei documenti

Ci sono 2 possibili metodi per la rappresentazione dei documenti non strutturati e sono la `bag-of-words` e `tf-idf`.

## Metriche

$$
sim(\bold x_i,\bold x_q)=\dfrac{\bold x_i^T\cdot \bold x_q}{||\bold x_i||\cdot ||\bold x_q||}
$$

Una metrica largamente utilizzata per quantificare la similarità tra 2 documenti $\bold x_i$ e $\bold x_q$ è la cosine similarity che si avvale della rappresentazione vettoriale dei documenti

## Complessità della ricerca

![Screenshot from 2024-04-06 16-02-52.png](Screenshot_from_2024-04-06_16-02-52.png)

Il calcolo delle distanze tra documenti può essere computazionalmente pesante quando $N$ è molto elevato.

Dato un query point il costo della scansione su tutti i punti è:

- $O(N)$ per una query per $1-NN$
- $O(N\cdot log(k))$ per una query per $k-NN$

## KD-trees

Per rendere più efficiente la ricerca è possibile utilizzare questa struttura dati che permette un’organizzazione strutturata degli item partizionando ricorsivamente i data point in `axis-aligned-boxes`. 

![Screenshot from 2024-04-06 16-08-25.png](Screenshot_from_2024-04-06_16-08-25.png)

Si suppone di avere questi data point, 

![Screenshot from 2024-04-06 17-18-35.png](Screenshot_from_2024-04-06_17-18-35.png)

Si fa poi una suddivisione sulle 2 feature

![Screenshot from 2024-04-06 17-19-02.png](Screenshot_from_2024-04-06_17-19-02.png)

Si procede in tal modo fino a completare l’albero

![Screenshot from 2024-04-06 17-21-09.png](Screenshot_from_2024-04-06_17-21-09.png)

Il bounding box è il più piccolo rettangolo che contiene tutti i punti

Quando si deve decidere la scelta della feature dove fare lo split si considerano le seguenti euristiche

- scelta della dimensione
- valore della feature a cui effettuare lo split
- condizione di terminazione, ad esempio il numero di punti contenuti dai rettangolini se il loro numero sta sotto una determinata soglia

![Screenshot from 2024-04-06 17-24-10.png](Screenshot_from_2024-04-06_17-24-10.png)

Dato un query point, si attraversa l’albero alla ricerca del nearest neighbor

![Screenshot from 2024-04-06 17-33-42.png](Screenshot_from_2024-04-06_17-33-42.png)

Naturalmente avendo le coordinate si può navigare nell’albero

![Screenshot from 2024-04-06 17-34-23.png](Screenshot_from_2024-04-06_17-34-23.png)

e cosi via

![Screenshot from 2024-04-06 17-34-35.png](Screenshot_from_2024-04-06_17-34-35.png)

fino ad arrivare alla foglia che contiene il query point

![Screenshot from 2024-04-06 17-36-41.png](Screenshot_from_2024-04-06_17-36-41.png)

A questo punto si calcolano le distanze del query point con gli altri punti che si trovano all’interno del rettangolo rosso

Si ottiene che la distanza minima è la distanza che collega il punto con il punto più vicino; da cui si traccia un cerchio

![Screenshot from 2024-04-06 17-38-22.png](Screenshot_from_2024-04-06_17-38-22.png)

Si fa backtrack e si provano gli altri rami per ogni nodo visitato, per vedere se ci sono punti più vicini

![Screenshot from 2024-04-06 17-39-54.png](Screenshot_from_2024-04-06_17-39-54.png)

Quello che si fa è calcolare la distanza del query point dal bounding box degli altri rami.

![Screenshot from 2024-04-06 17-41-19.png](Screenshot_from_2024-04-06_17-41-19.png)

La distanza è minore di quella corrente, perciò si visitano i sottoalberi

![Screenshot from 2024-04-06 17-42-15.png](Screenshot_from_2024-04-06_17-42-15.png)

Visto che la distanza dal bounding box di questo nodo è superiore alla minima viene potato

(Il professore qui non è stato chiaro ma la nuova distanza corrente diventa quella mostrata in questa immagini, in teoria vuole dire che data quella distanza si hanno i documenti più simili possibili)

![Screenshot from 2024-04-06 17-43-04.png](Screenshot_from_2024-04-06_17-43-04.png)

Si fa backtrack e si provano altri rami per ogni nodo visitato ottenendo come mostrato in figura il pruning complessivo

Si ottengono alla fine i punti più vicini